import React, { useState, useEffect } from "react";

const API_BASE = "http://localhost:5000/api";

function App() {
  const [isLogin, setIsLogin] = useState(true);
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [form, setForm] = useState({ name: "", email: "", password: "" });
  const [message, setMessage] = useState("");

  useEffect(() => {
    async function fetchProfile() {
      if (!token) return;
      const res = await fetch(`${API_BASE}/profile`, {
        headers: { Authorization: `Bearer ${token}` },
      });
      if (res.ok) {
        const data = await res.json();
        setUser(data);
        setMessage("");
      } else {
        setMessage("Session expired. Please login again.");
        setToken(null);
        localStorage.removeItem("token");
      }
    }
    fetchProfile();
  }, [token]);

  const handleInput = (e) =>
    setForm({ ...form, [e.target.name]: e.target.value });

  const handleSubmit = async (e) => {
    e.preventDefault();
    const url = isLogin ? `${API_BASE}/login` : `${API_BASE}/signup`;
    const body = isLogin
      ? { email: form.email, password: form.password }
      : { name: form.name, email: form.email, password: form.password };

    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });
    const data = await res.json();
    if (res.ok) {
      setToken(data.token);
      localStorage.setItem("token", data.token);
      setUser(data.user);
      setMessage("");
    } else {
      setMessage(data.msg || "Authentication failed");
    }
  };

  const handleLogout = () => {
    setToken(null);
    setUser(null);
    localStorage.removeItem("token");
    setForm({ name: "", email: "", password: "" });
    setMessage("");
  };

  if (user)
    return (
      <div style={{ maxWidth: 400, margin: "auto", padding: 20 }}>
        <h2>Welcome, {user.name}</h2>
        <p>Email: {user.email}</p>
        <p>XP: {user.xp}</p>
        <p>Badges: {user.badges.join(", ") || "None"}</p>
        <p>Points: {user.points}</p>
        <p>Level: {user.level}</p>
        <button onClick={handleLogout}>Logout</button>
      </div>
    );

  return (
    <div style={{ maxWidth: 400, margin: "auto", padding: 20 }}>
      <h2>{isLogin ? "Login" : "Sign Up"}</h2>
      <form onSubmit={handleSubmit}>
        {!isLogin && (
          <input
            name="name"
            value={form.name}
            onChange={handleInput}
            placeholder="Name"
            required
            style={{ width: "100%", marginBottom: 10, padding: 8 }}
          />
        )}
        <input
          type="email"
          name="email"
          value={form.email}
          onChange={handleInput}
          placeholder="Email"
          required
          style={{ width: "100%", marginBottom: 10, padding: 8 }}
        />
        <input
          type="password"
          name="password"
          value={form.password}
          onChange={handleInput}
          placeholder="Password"
          required
          style={{ width: "100%", marginBottom: 10, padding: 8 }}
        />
        <button type="submit" style={{ width: "100%", padding: 10 }}>
          {isLogin ? "Login" : "Sign Up"}
        </button>
      </form>
      <p
        style={{ marginTop: 10, cursor: "pointer", color: "blue" }}
        onClick={() => {
          setIsLogin(!isLogin);
          setMessage("");
        }}
      >
        {isLogin ? "Need an account? Sign Up" : "Already have an account? Login"}
      </p>
      {message && <p style={{ color: "red" }}>{message}</p>}
    </div>
  );
}

export default App;
const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');

const app = express();
app.use(express.json());

const JWT_SECRET = 'supersecretkey123'; // Use a strong secret in real use-case

// In-memory user "database"
const users = [];

// Generate JWT token
function generateToken(user) {
  return jwt.sign({ email: user.email }, JWT_SECRET, { expiresIn: '7d' });
}

// Signup route
app.post('/api/signup', async (req, res) => {
  const { name, email, password } = req.body;
  if (!name || !email || !password)
    return res.status(400).json({ msg: 'All fields required' });

  if (users.find((u) => u.email === email))
    return res.status(400).json({ msg: 'User already exists' });

  const hashedPassword = await bcrypt.hash(password, 10);
  const user = { name, email, password: hashedPassword, xp: 0, badges: [], points: 0, level: 1 };
  users.push(user);

  const token = generateToken(user);
  res.json({ token, user: { name, email, xp: 0, badges: [], points: 0, level: 1 } });
});

// Login route
app.post('/api/login', async (req, res) => {
  const { email, password } = req.body;
  if (!email || !password)
    return res.status(400).json({ msg: 'Email and password required' });

  const user = users.find((u) => u.email === email);
  if (!user) return res.status(400).json({ msg: 'Invalid credentials' });

  const isPasswordValid = await bcrypt.compare(password, user.password);
  if (!isPasswordValid) return res.status(400).json({ msg: 'Invalid credentials' });

  const token = generateToken(user);
  res.json({ token, user: { name: user.name, email, xp: user.xp, badges: user.badges, points: user.points, level: user.level } });
});

// JWT verification middleware
function authMiddleware(req, res, next) {
  const authHeader = req.headers['authorization'];
  if (!authHeader) return res.status(401).json({ msg: 'No token provided' });

  const token = authHeader.split(' ')[1];
  if (!token) return res.status(401).json({ msg: 'Token missing' });

  try {
    const decoded = jwt.verify(token, JWT_SECRET);
    req.userEmail = decoded.email;
    next();
  } catch (err) {
    res.status(401).json({ msg: 'Invalid token' });
  }
}

// Protected Profile route
app.get('/api/profile', authMiddleware, (req, res) => {
  const user = users.find((u) => u.email === req.userEmail);
  if (!user) return res.status(404).json({ msg: 'User not found' });

  res.json({ name: user.name, email: user.email, xp: user.xp, badges: user.badges, points: user.points, level: user.level });
});

// Start server
app.listen(5000, () => {
  console.log('Server running on http://localhost:5000');
});
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LearnTech School Portal</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f4f8;
    margin: 0; padding: 0;
  }
  header {
    background-color: #2563eb;
    color: white;
    text-align: center;
    padding: 1rem 0;
    font-size: 1.5rem;
    font-weight: bold;
  }
  nav {
    background: white;
    display: flex;
    justify-content: center;
    padding: 0.5rem 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  nav a {
    color: #2563eb;
    margin: 0 1.2rem;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
  }
  nav a:hover {
    text-decoration: underline;
  }
  main {
    max-width: 900px;
    background: white;
    margin: 2rem auto;
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  }
  h2.section-title {
    margin-bottom: 1rem;
    color: #2563eb;
  }
  /* Add stylings for modules, quizzes, notifications sections here */
</style>
</head>
<body>

<header>LearnTech School Portal</header>

<nav>
  <a href="#">Dashboard</a>
  <a href="#">Modules</a>
  <a href="#">Quizzes</a>
  <a href="#">Profile</a>
  <a href="#">Logout</a>
</nav>

<main>
  <h2 class="section-title">Welcome, Student!</h2>
  <p>This is your dashboard. View your progress, complete modules, and take quizzes.</p>

  <!-- Dashboard content placeholders -->
  <section id="progress">
    <h3>Your Progress</h3>
    <p>XP: 320/500</p>
    <p>Badges: Starter, Quiz Ace</p>
  </section>

  <section id="modules">
    <h3>Modules</h3>
    <ul>
      <li>Module 1: HTML Basics - Completed</li>
      <li>Module 2: CSS Styling - In Progress</li>
      <li>Module 3: JavaScript Fundamentals - Locked</li>
    </ul>
  </section>

  <section id="quizzes">
    <h3>Upcoming Quizzes</h3>
    <ul>
      <li>Quiz 1: Knowledge Test</li>
      <li>Quiz 2: Knowledge Test</li>
    </ul>
  </section>

</main>

</body>
</html>
